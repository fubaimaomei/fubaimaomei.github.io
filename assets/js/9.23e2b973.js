(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{267:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("本次学习项目实战地址: "),a("a",{attrs:{href:"https://github.com/fubaimaomei/koa.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("CRUD 实战"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"基础知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础知识"}},[t._v("#")]),t._v(" 基础知识")]),t._v(" "),a("p",[t._v("Node.js 是一个基于 Chrome v8 引擎的 JavaScript 运行时环境。")]),t._v(" "),a("blockquote",[a("p",[t._v("运行时环境或运行时，托管运行时环境，亦或称之为 JavaScript 引擎。")])]),t._v(" "),a("p",[t._v("运行时是一个网络搭建平台，它把运行在底层的操作系统和体系结构的特点抽象出来，承担解释与编译、堆管理、来及回收机制、内存分配、安全机制等功能。")]),t._v(" "),a("p",[t._v("Chrome v8 引擎是一个高性能的 JavaScript 解释引擎。")]),t._v(" "),a("p",[t._v("Node.js 使用了事件驱动、非阻塞式 I/O 模型。轻量又高效，"),a("strong",[t._v("Node 并不是构建大型服务器网站的最佳选择")]),t._v("。")]),t._v(" "),a("p",[t._v("事件驱动是一种处理数据的方式，这种方式与传统的 CRUD 截然不同。在 CRUD 模式中只保存数据的当前状态，因此所有的后续变更都会直接在数据本体上进行处理。")]),t._v(" "),a("p",[t._v("这样做的弊端：")]),t._v(" "),a("ul",[a("li",[t._v("CRUD 会直接在数据存储区进行操作，会降低响应速度和性能水平，对进程的开销过大也会限制项目的规模和可扩展性。")]),t._v(" "),a("li",[t._v("在存在大量并发用户的协作域中，对于同一数据主体的操作很可能会引起冲突")]),t._v(" "),a("li",[t._v("在没有额外监听措施的情况下，任何节点都能够获得只有当前的状态快照，历史数据会丢失")])]),t._v(" "),a("p",[t._v("使用 Node.js 进行开发的过程其实就是使用 JavaScript 结合一些列处理核心功能的模块来创建 Web 服务器、通信等工具的过程。")]),t._v(" "),a("p",[t._v("NPM 的模块开发原则是大版本相同的接口必须保持兼容，然而这个原则并非强制执行，因此用户下载的最新版本也许会导致依赖包的行为完全不兼容，从而导致模块不可用。")]),t._v(" "),a("p",[t._v("package-lock.json 锁定了依赖版本号，用户下架将得到完全一致的依赖包，提高模块的稳定性和可用性。")]),t._v(" "),a("p",[a("code",[t._v("nvm install stable")]),t._v(" "),a("code",[t._v("nvm install 8.11.1")]),t._v(" "),a("code",[t._v("nvm install 8.11")]),t._v(" "),a("code",[t._v("nvm ls-remote")]),t._v(" "),a("code",[t._v("nvm use 8.11.1")]),t._v(" "),a("code",[t._v("nvm ls")]),t._v(" "),a("code",[t._v("nvm nvm alias default node")])]),t._v(" "),a("p",[t._v("NProxy 代理工具")]),t._v(" "),a("p",[a("code",[t._v("npm i -g nproxy")])]),t._v(" "),a("p",[t._v("启动 代理地址默认为 127.0.0.1:8989")]),t._v(" "),a("p",[a("code",[t._v("nproxy -l replace_rule.js")])]),t._v(" "),a("p",[t._v("replace_rule.js")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        pattern"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'homepage.js'")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pathname")]),t._v("\n        responder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/goddyzhao/workspace/homepage.js"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//替换资源")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[a("code",[t._v("ctx.response.redirect(url,[alt])")])]),t._v(" "),a("p",[t._v("该方法用于将状态码 302 重定向到 URL，例如用户登录后重定向到网站的首页。")]),t._v(" "),a("p",[t._v("全局属性挂载在 ctx.state 上。")]),t._v(" "),a("p",[a("code",[t._v("ctx.cookies.get(name,[options]);")]),t._v(" 读取")]),t._v(" "),a("p",[a("code",[t._v("ctx.cookies.set(name,value,[options]);")]),t._v(" 设置")]),t._v(" "),a("p",[a("code",[t._v("ctx.throw(500)")]),t._v(" 把错误信息返回给用户")]),t._v(" "),a("p",[t._v("koa-compose 可以组和多个中间件为单一中间件,通过 app.use 注册使用")]),t._v(" "),a("p",[t._v("favicon 是 DOM 渲染时默认自带的静态资源。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_routes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缓存路由规则")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("handler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_routes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            url，\n            method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            handler\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" matchedRouter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_routers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("r")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("  r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" url "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" matchedRouter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" matchedRouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handler "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" matchedRouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br")])]),a("h2",{attrs:{id:"restful-规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restful-规范"}},[t._v("#")]),t._v(" RESTful 规范")]),t._v(" "),a("p",[t._v("REST 的全称 Representational State Tranfer 即表现出状态转移.")]),t._v(" "),a("p",[t._v("REST 设计一般符合以下条件：")]),t._v(" "),a("ul",[a("li",[t._v("程序或应用的事物都应该抽象为资源")]),t._v(" "),a("li",[t._v("每个资源对应唯一的 URI")]),t._v(" "),a("li",[t._v("使用统一接口对资源进行操作")]),t._v(" "),a("li",[t._v("对资源的操作不会改变资源标识")]),t._v(" "),a("li",[t._v("所有的操作都是无状态的")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// https://api.test.com/users   // create")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// https://api.test.com/users/:id // delete")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// https://api.test.com/users/:id // put")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// https://api.test.com/users/:id // get")]),t._v("\n\nrouter\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/users'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boyd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("新增了一位用户")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("del")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/users/:id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'删除了用户编号为id的用户'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/users/:id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'修改了用户编号为id的用户'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/users/:id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'我是编号为id的用户信息'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("h4",{attrs:{id:"名称路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#名称路由"}},[t._v("#")]),t._v(" 名称路由")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/users/:id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nrouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 调用路由的名称,生成路由 == "/users/3"')]),t._v("\n\nrouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("redirect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sign-in'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 路由重定向")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h4",{attrs:{id:"嵌套路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#嵌套路由"}},[t._v("#")]),t._v(" 嵌套路由")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" forums "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" posts "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nposts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nposts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/:pid'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nforums"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'forums/:fid/posts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("posts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("posts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("allowedMethods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("forums"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// usage")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// /forums/123/posts // 文章列表接口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// /forums/123/posts/123 //某篇文章接口")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("h4",{attrs:{id:"路由前缀"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由前缀"}},[t._v("#")]),t._v(" 路由前缀")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" router "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/users"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nrouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 匹配 /users")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h4",{attrs:{id:"url-参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#url-参数"}},[t._v("#")]),t._v(" url 参数")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/:category/:title"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// /programming/how-to-koa")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// -> { category: 'programming',title: 'how-to-koa' }")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("对于资源访问的权限控制，最常见的两种方式")]),t._v(" "),a("ul",[a("li",[t._v("基于 cookie 的认证模式")]),t._v(" "),a("li",[t._v("另一种是 Token 的认证模式 (无状态)")])]),t._v(" "),a("h4",{attrs:{id:"http"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http"}},[t._v("#")]),t._v(" HTTP")]),t._v(" "),a("p",[t._v("http/1.0 新增了 post / put / head / delete / link 等命令。还增加了头部信息 User-Agent/Accept/Last-modified/content-type")]),t._v(" "),a("p",[t._v("http/1.1 又做了大量改进")]),t._v(" "),a("ul",[a("li",[t._v("默认使用持久连接")]),t._v(" "),a("li",[t._v("引入管道方式支持多请求发送")]),t._v(" "),a("li",[t._v("请求头增加 Host 字段，使一台物理服务器可以存在多个虚拟主机，共享同一 IP 地址")]),t._v(" "),a("li",[t._v("响应头增加 Transfer-Encoding 字段，引入 chunked 分块传输编码机制")]),t._v(" "),a("li",[t._v("增加 Cache-Control 头域，缓存机制更加强大")]),t._v(" "),a("li",[t._v("增加 Content-Range 头域，实现带宽优化")]),t._v(" "),a("li",[t._v("新增多种方法 OPTIONS / TRACE / CONNECT 等")]),t._v(" "),a("li",[t._v("新增 24 个 HTTP 状态码,如 203,205,206,307 等")])]),t._v(" "),a("p",[t._v("URI - 同一资源标识符\nURL - 统一资源定位符")]),t._v(" "),a("p",[t._v("URL 是 URI 的子集。")]),t._v(" "),a("p",[t._v("一个完整的 URL 一般由 7 部分组成")]),t._v(" "),a("p",[a("code",[t._v("scheme: [//[user[:password]@host[:port]][/path][?query][#fragment]]")])]),t._v(" "),a("p",[t._v("HTTP/2.0")]),t._v(" "),a("p",[t._v("HTTP/1.* 均采用文本格式传输数据，而 HTTP/2 则选择了二进制格式传输数据。在 HTTP/2 中，基本的协议单位是帧，每个数据流以消息的形式发送，消息由一个或多个帧组合而成。帧的内容包括： 长度，类型，标记，保留字段，流标识符和帧主体。")]),t._v(" "),a("p",[t._v("HTTP/2.0 支持双向数据流,HTTP 并发多请求，必需创建多个 TCP 连接，1.1 引入了流水线技术，但先天的先进先出机制导致当前请求依赖于上一个请求的结束。在搞密集 IO 中，容易引起报头阻塞。")]),t._v(" "),a("p",[t._v("2.0 一个域名只需占用一个 TCP 连接，通过数据流，以帧为基本协议单位，避免了因频繁创建连接产生的延迟，减少了内存消耗，提升了使用性能。")]),t._v(" "),a("p",[t._v("客户端可以提供 Weight 一个 8 位无符号整形，代表流的优先级，高优先级的流会被服务器优先处理并返回给客户端。")]),t._v(" "),a("h2",{attrs:{id:"mvc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mvc"}},[t._v("#")]),t._v(" MVC")]),t._v(" "),a("p",[t._v("MVC 全名 Model View Controller ,模型、视图、控制器。MVC 是一种设计典范，用逻辑、数据、视图分离的方式组织代码，在对界面及用户交互进行修改的同时，业务逻辑的部分代码可以保持不变。")]),t._v(" "),a("p",[t._v("MVC 不是一种技术，是一种设计理念。MVC 模式主要采用分层的思想来降低耦合度，从而使系统更加灵活，扩展性更强。")]),t._v(" "),a("p",[t._v("三层架构是一个分层式的架构设计理念，如有必要，也可以分为多层，分层的设计理念契合了 “高内聚低耦合”的思想，在软件系架构设计中最常见，也是最重要的一种结构。")]),t._v(" "),a("p",[a("strong",[t._v("虽然 MVC 和三层架构看起来非常像，但本质上两者完全不一样。")])]),t._v(" "),a("p",[t._v("MVC 可以理解为三角结构，视图向控制器发送更新通知，控制器更新模型，然后出发视图更新。\n三层架构更像是线性结构，界面层不能直接与数据访问层通信，它们之间必需通过业务逻辑层来访问。三层架构是一种架构设计理念，适用于所有项目，MVC 模式更像是对界面层的细化。")]),t._v(" "),a("p",[t._v("但不管是 MVC 还是三层架构，其设计理念都是一致的：分层，解耦。")]),t._v(" "),a("blockquote",[a("p",[t._v("总结，三层架构是线性结构，MVC 是三角结构。")])]),t._v(" "),a("p",[t._v("开发 Web 应用时，必然会涉及两个方向：一个是前端界面，另一个是后端服务。")]),t._v(" "),a("p",[t._v("常规的 SPA 不利于 SEO，不利于 SSR。")]),t._v(" "),a("p",[t._v("模版引擎是 Web 应用中用来生成动态 HTML 的工具，负责将数据模型与 HTML 模版结合，生成最终的 HTML 。")]),t._v(" "),a("p",[a("strong",[t._v("模版引擎是为了解决用户界面与数据分离而产生的。")])]),t._v(" "),a("p",[t._v("浏览器通过 MIME Type 来区分不同的资源类型，而 MIME Type 是由 web 服务器告知浏览器的，被定义在 Content-Type-header 中。")]),t._v(" "),a("p",[t._v("MIME 多用于互联网邮件扩展类型，当该扩展类型的文件被访问的时候，浏览器会自动打开相应的程序来打开。")]),t._v(" "),a("p",[t._v("实际项目开发中，使用工具查看 HTTP 请求过程，若返回的页面响应头信息中指定了 content-type:text/html ，则浏览器会把字符串渲染成 HTML 页面。HTTP 请求的整个过程中所传输的数据，本身没有任何特定的格式和形态，但客户端接收到数据时，会按照 MIME Type 指定的方式去处理。")]),t._v(" "),a("p",[t._v("因此客户端期望的 JSON 数据，也因此处理。即告知客户端数据类型是 JSON，客户端就会按照 JSON 格式来解析了。")]),t._v(" "),a("p",[t._v("关键代码:")]),t._v(" "),a("p",[a("code",[t._v('ctx.set("Content-Type","application/json")')])]),t._v(" "),a("p",[a("code",[t._v("ctx.body = JSON.stringify(json);")])]),t._v(" "),a("p",[t._v("把上述步骤处理为 Koa 中间件")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 扩展 ctx")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("h2",{attrs:{id:"数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库"}},[t._v("#")]),t._v(" 数据库")]),t._v(" "),a("p",[t._v("数据库具备以下特点:")]),t._v(" "),a("ul",[a("li",[t._v("数据共享。数据库中的数据可以同时被多人查询和写入。")]),t._v(" "),a("li",[t._v("减少数据冗余。与文件系统对比，数据库实现了数据共享，从而避免了文件复制，降低了数据冗余度。")]),t._v(" "),a("li",[t._v("数据独立。数据库中的数据和业务是独立的。")]),t._v(" "),a("li",[t._v("数据一致性和可维护性。数据库中的数据应当保持一致，以防止数据丢失和越权使用。在同一周期内，既能允许数据实现多路存取，也能防止用户之间的数据操作相互影响。 一般情况下是通过隔离级别来保证数据的一致性。")]),t._v(" "),a("li",[t._v("故障恢复。可以及时发现故障和修复故障，从而防止数据被损坏。")])]),t._v(" "),a("p",[t._v("数据库的操作都是基于事务，可以通过索引来提升查询效率。")]),t._v(" "),a("p",[t._v("一般来说，非关系数据库存储的数据结构比较简单，并且不需要支持复杂的查询。在开发时，可以选择 MongoDB 这样的数据库来存储。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/c3dcd4d9ce69",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mysql workbench 使用说明"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Node.js 中，一般采用 sequelize 这个 ORM 类库来操作数据库。sequelize 相比 SQL 提供了更加快捷方式存取数据到数据库里。")]),t._v(" "),a("p",[a("code",[t._v("npm install sequelize -S")])]),t._v(" "),a("h2",{attrs:{id:"数据库连接池"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库连接池"}},[t._v("#")]),t._v(" 数据库连接池")]),t._v(" "),a("p",[t._v("数据库连接池是程序启动时建立足够的数据库连接，并将这些连接组成一个连接池，由程序动态地对池中的连接进行申请，使用，释放。")]),t._v(" "),a("blockquote",[a("p",[t._v("通俗理解：创建数据库连接池是一个很耗时的操作，也容易对数据库造成安全隐患。所以，在程序初始化的时候，集中创建多个数据库连接，并把他们呢集中管理，供程序使用，可以保证较快的数据库读写速度，还更安全可靠。")])]),t._v(" "),a("p",[t._v("访问 MySQL 服务器的软件包，称为驱动程序。mysql 命令行程序用的是 C 驱动。")]),t._v(" "),a("h2",{attrs:{id:"session"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[t._v("#")]),t._v(" Session")]),t._v(" "),a("p",[t._v('Session 也被称为 "会话控制",顾名思义，它是用于控制网络会话的，如用户的登录信息、购物车中的商品，或者用户的一些浏览喜好都可以存储在 Session 中。HTTP 是一种无状态的协议，本身无法标识一次特定的会话，所以需要一种机制去保存当前用户的特定信息。Session 就是其中一种保存会话信息的实现方式，有了 Session，不同的用户登录购物网站之后就能看到各自购物车中的商品了，否则，所有的用户将会操作同一个购物车。\nSession 中的数据是保存在服务器端的。在服务器端有很多种存储方式，即可以直接保存在内存中，也可以保存在 Redis、MogonDB、MySQL 等数据库中，甚至可以保存在普通的文件中。但是 Session 中的数据一般都是短时间内高频率访问的，需要保证性能，所以比较好的方式是内存配合 Redis 做一个持久化。这是因为内存访问的性能是最好的，但是容易丢失数据，如遇到重启服务器等情况。因此，可以在 Redis 中做一个备份，当内存中的数据丢失时，就可以从 Redis 中恢复数据。')]),t._v(" "),a("p",[t._v("除了服务端保存完整的 Session 数据外，还需要在客户端通过 cookie 来保存 Session 的一个唯一标识，通常是一个 ID ，通过这个 ID 可以匹配到服务器端完整的 Session 数据。"),a("strong",[t._v("使用 Cookie 存储 Session 的 ID 是因为每个 HTTP 请求头中都可以带上 Cookie 信息")]),t._v("，并且可以根据情况这是 HttpOnly 为 true,防止客户端恶意篡改 Session 的 ID。")]),t._v(" "),a("h2",{attrs:{id:"单元测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单元测试"}},[t._v("#")]),t._v(" 单元测试")]),t._v(" "),a("p",[t._v("单元测试又称模块测试，是对程序进行检验的测试工作。所谓单元是指程序应用的最小可测试部件，通常是单个函数、过程或方法。单元测试是开发者通过代码完成的。")]),t._v(" "),a("p",[t._v("单元测试通常拥有如下优势")]),t._v(" "),a("ul",[a("li",[t._v("尽早发现问题并进行更正。")]),t._v(" "),a("li",[t._v("简化集成测试的复杂度。")]),t._v(" "),a("li",[t._v("生成文档，并且在代码迭代中，测试代码可以减少大量重复测试行为。")])]),t._v(" "),a("p",[t._v("TDD 是测试驱动开发(Test Driven Developemnt)的简称，倡导首先写测试程序，然后编写实现其功能；\nBDD 是行为驱动开发(Behavior Driven Development)的简称，是一种测试驱动开发的回应，鼓励软件项目中的开发者、测试人员和非技术人员进行协作，"),a("strong",[t._v("通过用自然语言书写非程序员可读的测试用例")]),t._v("扩展了测试驱动开发方法。TDD 和 BDD 并非是对立概念，而是不同层级的概念。")]),t._v(" "),a("h4",{attrs:{id:"chai-断言库。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chai-断言库。"}},[t._v("#")]),t._v(" Chai 断言库。")]),t._v(" "),a("p",[t._v("所谓断言是一种在程序中的逻辑判断，目的是检查结果与开发者的预想一致。\nNode.js 内置了 Assert 断言库，但 Assert 并不是一个真正测试运行器，没有便捷的 API 可供使用，所以在单元测试是首推使用 Chai。")]),t._v(" "),a("p",[t._v("chai 包含三个断言库:")]),t._v(" "),a("ul",[a("li",[t._v("Expect BDD")]),t._v(" "),a("li",[t._v("Should BDD")]),t._v(" "),a("li",[t._v("Assert TDD")])]),t._v(" "),a("p",[t._v("Mocha 是一个功能丰富且流行的 JavaScript 测试框架，支持回调函数/Promise/Async 等。Mocha 是一个测试框架，所谓测试框架，就是运行测试的工具会接管单元代码的执行，可以理解为一个任务运行器，配合断言库判断代码是否符合预期结果。同时 Mocha 也会提供一个简单的测试结果。")]),t._v(" "),a("h2",{attrs:{id:"优化与部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化与部署"}},[t._v("#")]),t._v(" 优化与部署")]),t._v(" "),a("p",[t._v("在应用中，记录完善的日志可以带来如下好处")]),t._v(" "),a("ul",[a("li",[t._v("显示程序运行状态。")]),t._v(" "),a("li",[t._v("帮助开发者排除故障")]),t._v(" "),a("li",[t._v("结合专业的日志分析工具给出预警. (Elasticsearch、Logstash、Kibana)")])]),t._v(" "),a("p",[t._v("日志分类")]),t._v(" "),a("ul",[a("li",[t._v("访问日志 记录用户的访问信息")]),t._v(" "),a("li",[t._v("应用日志 开发者根据业务需求输出的调用跟踪、警告和异常等信息")])]),t._v(" "),a("p",[t._v("日志等级")]),t._v(" "),a("ul",[a("li",[t._v("trace 调用的跟踪信息，标记方法被调用，级别最低")]),t._v(" "),a("li",[t._v("debug 调试信息")]),t._v(" "),a("li",[t._v("info 非调试和跟踪的信息")]),t._v(" "),a("li",[t._v("warn 警告信息")]),t._v(" "),a("li",[t._v("error 错误信息")]),t._v(" "),a("li",[t._v("fatal 严重错误信息")])]),t._v(" "),a("h2",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[t._v("#")]),t._v(" Docker")]),t._v(" "),a("p",[t._v("Docker 是个容器引擎，能够让应用部署在软件容器下，这个容器是在 linux 操作系统上的一个软件抽象层。和传统的采用虚拟机部署相比，Docker 所创建的多个独立容器是可以在单一 Linux 实体下运行的，这些容器共享一个宿主内核。而不像在"),a("strong",[t._v("虚拟机中需要一个完整的操作系统来运行应用")]),t._v("。\n因此，Docker 可以更快地启动并占用更少的资源。")]),t._v(" "),a("p",[t._v("Docker 是一个更适合 云时代 的开发部署方式。传统的部署中都需要对宿主机或虚拟机进行大量的环境配置，有时候需要开发人员和运维人员才能完成部署；而在 Docker 部署中，开发人员可以直接打包一个 Docker 环境的镜像，所有的配置都在镜像中完成；运维只需要将镜像加载到 Docker 中即可。通过容器，还可以隔离不同容器中的应用环境，从而能在宿主机中运行大量应用，而这些应用不会相互影响。")])])}),[],!1,null,null,null);s.default=e.exports}}]);